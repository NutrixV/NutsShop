# NutsShop
## Стисла документація проекту 

### Посилання:
- Git: https://github.com/your-username/NutsShop
- Середовище на Render: https://nuts-shop.onrender.com/

### Локальне середовище:
- Frontend: http://localhost:3000
- API: http://localhost:8090/api

### Середовище на Render:
- Frontend: https://nuts-shop.onrender.com/
- API: https://nuts-shop.onrender.com/api/

## 1. Архітектура:
Проект реалізований як SPA (Single Page Application) з окремим бекенд-API на Laravel.

### Основні компоненти:
#### Бекенд (REST API):
- **Моделі**: представлення даних та бізнес-логіки
  - `CatalogCategory` - категорії продуктів (горіхи, шоколад, тощо)
  - `CatalogProduct` - продукти (різні види горіхів, шоколаду, солодощів)
  - `CustomerEntity` - клієнти/користувачі системи
  - `Quote` та `QuoteItem` - кошик та елементи кошика
  - `Order` та `OrderItem` - замовлення та елементи замовлень

- **Контролери**: обробка API запитів
  - `Api\CatalogController` - операції з каталогом продуктів
  - `Api\CartController` - управління кошиком покупця
  - `Api\CustomerController` - управління обліковими записами
  - `Api\OrderController` - замовлення та їх статуси

#### Фронтенд (Vue.js SPA):
- Компоненти інтерфейсу
- Composables для логіки
- Vuex для управління станом (або Pinia)

### Структура проекту
```
/
├── frontend/               # Vue.js SPA 
│   ├── src/
│   │   ├── components/     # UI компоненти
│   │   ├── composables/    # Логіка додатку
│   │   ├── views/          # Сторінки
│   │   └── store/          # Vuex сховище
│   └── public/             # Статичні файли
│
├── backend/                # Laravel API
│   ├── app/
│   │   ├── Http/
│   │   │   ├── Controllers/  # Контролери API
│   │   │   └── Middleware/   # Middleware для обробки запитів
│   │   ├── Models/           # Моделі даних
│   │   └── Providers/        # Service Providers
│   ├── config/               # Конфігурації Laravel
│   ├── database/             # Міграції та сідери
│   │   ├── migrations/       # Структура бази даних
│   │   └── seeders/          # Генерація тестових даних
│   ├── public/               # Публічна директорія для статичних файлів
│   │   └── storage/          # Символічне посилання на storage/app/public
│   ├── routes/               # Визначення маршрутів API
│   └── storage/              # Файли зберігання (зображення, логи)
│       └── app/public/       # Публічні файли (зображення продуктів)
└── docker/                   # Docker конфігурації
    ├── nginx/                # Налаштування Nginx
    └── php/                  # Налаштування PHP
```

## 2. Технології (версії):
### Бекенд:
- PHP: 8.2
- Laravel: 10.x
- Composer: 2.5.x

### База даних:
- PostgreSQL: 14

### Фронтенд:
- Vue.js: 3.x
- TypeScript
- Vite: для збірки

### Середовище розробки:
- Docker: для локальної розробки 
- Nginx: веб-сервер
- Render.com: хостинг платформа для деплойменту

## 3. Адміністративна панель
Адміністративна панель реалізована як частина фронтенд-додатку з Vue.js.

### Реалізовано функціонал:
- **Управління продуктами:**
  - Додавання, редагування, видалення продуктів
  - Керування атрибутами: ціна, опис, категорія, наявність
  - Завантаження зображень
- **Керування категоріями:**
  - Створення та редагування категорій
  - Встановлення зв'язків категорій із продуктами
- **Управління користувачами:**
  - Перегляд списку зареєстрованих користувачів
  - Редагування інформації та статусу користувачів
- **Замовлення:**
  - Перегляд та управління замовленнями
  - Зміна статусу замовлень
  - Перегляд деталей замовлень
- **Доступ до адмінпанелі:**
  - Авторизація через окремий логін/пароль для адміністраторів
  - Захист через middleware на бекенді

## 4. Фронтенд
Фронтенд реалізований як SPA на Vue.js з використанням сучасних підходів.

### Технології:
- Vue.js 3 з Composition API
- TypeScript для типізації
- Vue Router для маршрутизації
- Axios для API запитів
- SCSS для стилів

### Ключові компоненти інтерфейсу:
- Головна сторінка з презентацією товарів
- Каталог продуктів з фільтрацією за категоріями
- Детальна сторінка продукту
- Кошик для управління вибраними товарами
- Система реєстрації та авторизації
- Особистий кабінет користувача з історією замовлень
- Адміністративні інтерфейси

### Особливості:
- Адаптивний дизайн для мобільних пристроїв
- Оптимізовані зображення для швидкого завантаження
- Асинхронна взаємодія з API
- Локальне збереження стану кошика в localStorage
- Авторизація через API токени

## 5. Структура бази даних
База даних PostgreSQL містить наступні основні таблиці:

### Основні таблиці:
**catalog_category**
- `category_id` - унікальний ідентифікатор
- `name` - назва категорії (унікальна)
- `description` - опис категорії
- `image` - шлях до зображення категорії
- `is_active` - статус активності
- `created_at`, `updated_at` - часові мітки

**catalog_product**
- `entity_id` - унікальний ідентифікатор
- `sku` - унікальний код продукту
- `name` - назва продукту
- `description` - повний опис продукту
- `short_description` - короткий опис
- `price` - ціна
- `base_currency` - валюта (USD, EUR тощо)
- `qty` - кількість на складі
- `is_in_stock` - наявність товару (boolean)
- `visibility` - видимість у каталозі
- `status` - статус активності
- `image` - шлях до основного зображення
- `image_alt` - альтернативний текст для зображення
- `gallery` - масив шляхів до додаткових зображень
- `nut_type` - тип горіхів (для специфічних продуктів)
- `origin_country` - країна походження
- `salted`, `roasted`, `gluten_free`, `organic` - атрибути продукту (boolean)
- `created_at`, `updated_at` - часові мітки

**customer_entity**
- `entity_id` - унікальний ідентифікатор
- `email` - електронна пошта (унікальна)
- `password` - хешований пароль
- `first_name` - ім'я
- `last_name` - прізвище
- `api_token` - токен для API-авторизації
- `created_at`, `updated_at` - часові мітки

**quote**
- `entity_id` - унікальний ідентифікатор кошика
- `customer_id` - зовнішній ключ до customer_entity (може бути NULL для гостей)
- `items_count` - кількість товарів у кошику
- `subtotal` - проміжна сума
- `grand_total` - кінцева сума з урахуванням знижок і податків
- `currency` - валюта
- `is_active` - статус активності кошика
- `created_at`, `updated_at` - часові мітки

**quote_item**
- `item_id` - унікальний ідентифікатор
- `quote_id` - зовнішній ключ до quote
- `product_id` - зовнішній ключ до catalog_product
- `sku` - код продукту (дублюється з продукту для швидкого доступу)
- `name` - назва продукту
- `price` - ціна за одиницю
- `qty` - кількість
- `row_total` - загальна вартість (price * qty)
- `created_at`, `updated_at` - часові мітки

**orders**
- `entity_id` - унікальний ідентифікатор
- `customer_id` - зовнішній ключ до customer_entity
- `status` - статус замовлення
- `total` - загальна сума
- `shipping_address` - адреса доставки
- `created_at`, `updated_at` - часові мітки

**order_items**
- `item_id` - унікальний ідентифікатор
- `order_id` - зовнішній ключ до orders
- `product_id` - зовнішній ключ до catalog_product
- `sku` - код продукту
- `name` - назва продукту
- `price` - ціна за одиницю на момент замовлення
- `qty` - кількість
- `row_total` - загальна вартість (price * qty)
- `created_at`, `updated_at` - часові мітки

### Зв'язки:
- catalog_category M --- N catalog_product (через pivot таблицю)
- customer_entity 1 --- * orders
- orders 1 --- * order_items
- catalog_product 1 --- * order_items
- customer_entity 1 --- * quote
- quote 1 --- * quote_item
- catalog_product 1 --- * quote_item

## 6. Формування фікстур (тестових даних)
Тестові дані генеруються за допомогою Laravel Seeders та Factories.

### Factory:
Фабрики можуть бути використані для генерації тестових даних з випадковими значеннями:
- `CustomerFactory` - створення тестових користувачів
- `CatalogProductFactory` - створення тестових продуктів

### Seeder:
Сідери відповідають за заповнення бази даних початковими або тестовими даними:
- `UserSeeder.php` - створює адміністраторів системи
- `CatalogSeeder.php` - створює категорії з зображеннями
- `ProductImportSeeder.php` - імпортує продукти з CSV-файлу та прикріплює зображення

### Запуск фікстур:
```bash
# Розгортання структури бази даних
php artisan migrate

# Заповнення тестовими даними
php artisan db:seed

# Специфічний сідер
php artisan db:seed --class=ProductImportSeeder
```

## 7. Енвайронменти (локальний та деплой)

### Локальне середовище:
- Docker Compose для локальної розробки
- Файл конфігурації: `.env`
- База даних: PostgreSQL в докер-контейнері
- Веб-сервер: Nginx в докер-контейнері
- Запуск: `docker-compose up -d`

### Середовище на Render.com:
- Налаштування через Render Dashboard
- Файл конфігурації: `.env.render`
- База даних: Render PostgreSQL Service
- Автоматичний деплой при пуші в репозиторій

### Розгортання на Render:
- **Бекенд**:
  - Тип сервісу: Web Service (PHP)
  - Налаштування бази даних PostgreSQL
  - Змінні середовища для Laravel
  - Постійне сховище для зображень

- **Фронтенд**:
  - Тип сервісу: Static Site
  - Налаштування базового URL для API
  - Конфігурація для SPA-маршрутизації

### Особливості налаштування:
- CORS для взаємодії між фронтендом і бекендом
- Кука для кошика із SameSite=None та Secure=true на продакшні
- Символічне посилання для доступу до медіа-файлів 

## 8. Список REST API ендпоінтів

Проект реалізує повний набір REST API для взаємодії між фронтендом та бекендом. Нижче наведено основні ендпоінти, згруповані за доменними областями.

### Автентифікація та користувачі
| Метод | Шлях | Опис | Параметри | Відповідь |
|-------|------|------|-----------|-----------|
| POST | `/api/customer/register` | Реєстрація нового користувача | `email`, `password`, `first_name`, `last_name` | Об'єкт користувача |
| POST | `/api/customer/login` | Авторизація користувача | `email`, `password` | Токен доступу |
| GET | `/api/customer/profile` | Отримання профілю користувача | - | Об'єкт користувача |
| PUT | `/api/customer/profile` | Оновлення профілю користувача | `first_name`, `last_name` та інші поля | Оновлений об'єкт користувача |
| POST | `/api/customer/logout` | Вихід користувача | - | Статус операції |

### Каталог продуктів
| Метод | Шлях | Опис | Параметри | Відповідь |
|-------|------|------|-----------|-----------|
| GET | `/api/catalog/categories` | Список усіх категорій | - | Масив категорій |
| GET | `/api/catalog/categories/{id}` | Детальна інформація про категорію | - | Об'єкт категорії |
| GET | `/api/catalog/products` | Список продуктів з фільтрацією | `category_id`, `page`, `limit`, `sort`, `filter` | Масив продуктів з пагінацією |
| GET | `/api/catalog/products/{id}` | Детальна інформація про продукт | - | Об'єкт продукту |
| GET | `/api/catalog/search` | Пошук продуктів | `query`, `category_id`, `page`, `limit` | Масив продуктів з пагінацією |

### Кошик
| Метод | Шлях | Опис | Параметри | Відповідь |
|-------|------|------|-----------|-----------|
| GET | `/api/cart` | Отримання поточного кошика | - | Об'єкт кошика з товарами |
| POST | `/api/cart/items` | Додавання товару в кошик | `product_id`, `qty` | Оновлений об'єкт кошика |
| PUT | `/api/cart/items/{id}` | Оновлення кількості товару | `qty` | Оновлений об'єкт кошика |
| DELETE | `/api/cart/items/{id}` | Видалення товару з кошика | - | Оновлений об'єкт кошика |

### Замовлення
| Метод | Шлях | Опис | Параметри | Відповідь |
|-------|------|------|-----------|-----------|
| GET | `/api/orders` | Список замовлень користувача | `page`, `limit` | Масив замовлень з пагінацією |
| GET | `/api/orders/{id}` | Детальна інформація про замовлення | - | Об'єкт замовлення |
| POST | `/api/orders` | Створення нового замовлення | `shipping_address`, `payment_method` | Об'єкт створеного замовлення |
| PUT | `/api/orders/{id}/cancel` | Скасування замовлення | - | Оновлений об'єкт замовлення |

### Адміністративні API
| Метод | Шлях | Опис | Параметри | Відповідь |
|-------|------|------|-----------|-----------|
| GET | `/api/admin/products` | Список усіх продуктів | `page`, `limit` | Масив продуктів з пагінацією |
| POST | `/api/admin/products` | Створення нового продукту | Дані продукту | Об'єкт створеного продукту |
| PUT | `/api/admin/products/{id}` | Оновлення продукту | Дані продукту | Об'єкт оновленого продукту |
| DELETE | `/api/admin/products/{id}` | Видалення продукту | - | Статус операції |
| GET | `/api/admin/categories` | Список усіх категорій | - | Масив категорій |
| POST | `/api/admin/categories` | Створення нової категорії | Дані категорії | Об'єкт створеної категорії |
| PUT | `/api/admin/categories/{id}` | Оновлення категорії | Дані категорії | Об'єкт оновленої категорії |
| DELETE | `/api/admin/categories/{id}` | Видалення категорії | - | Статус операції |
| GET | `/api/admin/customers` | Список усіх користувачів | `page`, `limit` | Масив користувачів з пагінацією |
| GET | `/api/admin/orders` | Список усіх замовлень | `page`, `limit`, `status` | Масив замовлень з пагінацією |
| PUT | `/api/admin/orders/{id}/status` | Зміна статусу замовлення | `status` | Об'єкт оновленого замовлення |

### Формат відповідей API
- Успішні відповіді повертаються з кодом 200 (OK) або 201 (Created)
- Помилки аутентифікації повертаються з кодом 401 (Unauthorized)
- Помилки доступу повертаються з кодом 403 (Forbidden)
- Помилки валідації повертаються з кодом 422 (Unprocessable Entity) і містять об'єкт помилок
- Загальні помилки повертаються з кодом 500 (Internal Server Error)

### Приклади використання
```javascript
// Отримання списку категорій
const response = await axios.get('/api/catalog/categories');
const categories = response.data;

// Додавання товару в кошик
const response = await axios.post('/api/cart/items', {
  product_id: 123,
  qty: 2
});
const cart = response.data;

// Авторизація користувача
const response = await axios.post('/api/customer/login', {
  email: 'user@example.com',
  password: 'password123'
});
const { token } = response.data;
// Зберігаємо токен для подальших запитів
axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
``` 